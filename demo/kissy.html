<!DOCTYPE html>
<html>
<head>
<meta charset="gb2312" />
<title>try kissy</title>
<link rel="shortcut icon" type="image/x-icon" href="/static/img/f.ico" />
<link rel="stylesheet" href="/static/css/base.css" />
<link rel="stylesheet" href="/static/css/demo.css" />
<style>
body{
	height: 2000px;
}
/* dialog */
.my .ks-stdmod-header, .my .ks-stdmod-footer {
	display: none;
}
.my .ks-stdmod-body {
	line-height: 0;
}
</style>
</head>
<body>
<div class="u-wrap">
	<div class="paper" id="paper">
	
	</div>
	<div class="code fn-mt20">
		kissy
	</div>
</div>
<script src="http://a.tbcdn.cn/s/kissy/1.3.0/seed-min.js"></script>
<script>

KISSY.use('core',function(S){
	S.all('.code').on('click',function(){
		//alert(0);
		return false;
	});
	//console.log(S.JSON.parse('{"x":1}'));
	//console.log(S.UA);
});

KISSY.add('mymod',function(S){
	S.tip = function(message){
		alert(message);
	}
});
KISSY.use('mymod', function(S){
	//S.tip('ok');
});


KISSY.use('core',function(S){
	// 自定义类
	function myClass(config) {
		myClass.superclass.constructor.call(this, config);
	}
	
	// 继承 Base
	S.extend(myClass, S.Base);
	
	// 增加属性
	myClass.ATTRS = {
		size: {
			value: 0,
			setter: function(v) {
				v ++;
				if (S.isString(v) && v.indexOf('inch')!== -1) {
					return parseFloat(v)*10/3;
				}
				return parseFloat(v);
			},
			getter: function(v) {
				return v;
			}
		}
	};

	var newClass = new myClass();
	
	newClass.addAttrs({
		width: {
			value: 0,
			setter: function(v) {
				v += 2;
				if (S.isString(v) && v.indexOf('inch')!== -1) {
					return parseFloat(v)*10/3;
				}
				return parseFloat(v);
			},
			getter: function(v) {
				return v;
			}
		}
	});
	
	// 绑定事件
	newClass.on('afterSizeChange', function(ev){
		//console.log('change '+ ev.attrName + ': '+ev.prevVal+' --> '+ev.newVal);
	});
	
	newClass.set('size', 20);
	//alert(newClass.get('size'));
	
	newClass.reset();
	//alert(newClass.get('size'));
	
	newClass.set('width', 20);
	//alert(newClass.get('width'));
});



// 年度第几周，每年的第一个周末开始才能算是第一周
var getYearWeek = function(date){
	var currDate;
	if (date) {
		date = date.replace(/\/|\-/g, '.');
		currDate = date.split('.');
		currDate[1] --;
		var date1 = new Date(currDate[0], currDate[1], currDate[2]);
	} else {
		var date1 = new Date();
		currDate = [date1.getFullYear(), date1.getMonth(), date1.getDate()]
	}
	var date2 = new Date(currDate[0], 0, 1);
	var days = (date1.valueOf() - date2.valueOf()) / 86400000;
	if (days < 7 && date1.getDay() >= date2.getDay() && date2.getDay() != 0) {
		currDate[0] --;
		date1 = new Date(currDate[0], 11, 31);
		date2 = new Date(currDate[0], 0, 1);
		days = (date1.valueOf() - date2.valueOf()) / 86400000;
	}
	var yearWeek = Math.floor((days + date2.getDay()) / 7);
	if (date2.getDay() == 0) {
		yearWeek ++
	}
	return {
		'year': currDate[0],
		'week': yearWeek
	}
};

console.log('2013.04.26：' + getYearWeek('2013.04.26').week);
console.log('2013.01.01：' + getYearWeek('2013.01.01').year + ' ' + getYearWeek('2013.01.01').week);
console.log('2013.01.02：' + getYearWeek('2013/1/2').week);
console.log('2013.01.03：' + getYearWeek('2013.01.03').week);
console.log('2013.01.04：' + getYearWeek('2013.01.04').week);
console.log('2013.01.05：' + getYearWeek('2013.01.05').week);
console.log('2013.01.06：' + getYearWeek('2013.01.06').year + ' ' + getYearWeek('2013.01.06').week);
console.log('2013.12.31：' + getYearWeek('2013.12.31').week);
console.log('2014.01.01：' + getYearWeek('2014.01.01').week);
</script>
</body>
</html>